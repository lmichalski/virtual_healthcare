/*!

   Drive analytics plugin for Flowplayer HTML5

   Copyright (c) 2016, Flowplayer Oy

   Released under the ISC License:
   https://opensource.org/licenses/ISC

*/
!function(){function e(e){var n=document.createElement("a");return n.href=e,n.href}function n(e){var n=document.createElement("a");n.href=e;var o=["cdn.flowplayer.org","drive.flowplayer.org"],r=["cdn.dev.flowplayer.org"];return o.indexOf(n.hostname)!==-1?"https://api.flowplayer.org/events/play":r.indexOf(n.hostname)!==-1?"https://api.flowplayer.org/events/dev/play":void 0}var o=function(o){o(function(r){function t(e){e&&r.off(".drivetrack")}var i,s={},a={};"undefined"!=typeof xflow&&xflow.Broker.on(xflow.Events.STATS,function(n){var o=e(n.src);return n.p2p?(s[o]||(s[o]=0),void(s[o]+=n.loaded)):(a[o]||(a[o]=0),void(a[o]+=n.loaded))}),r.on("ready",function(f,c,d){function p(o,r,t,i,f){if("number"==typeof r&&isFinite(r)){var c=n(o);if(c){var d=new XMLHttpRequest;d.open("POST",c),d.setRequestHeader("Content-Type","application/json"),d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&200!==d.status&&f(new Error("Request error"))};var p=e(o);d.send(JSON.stringify({play:{src:o,seconds:r,p2pBytes:s[p],cdnBytes:a[p],playerVersion:t,finished:!!i}})),a[p]=0,s[p]=0}}}r.one(r.conf.splash?"progress":"resume",function(){p(d.src,0,o.version,!1,t),i=5,r.on("progress.drivetrack",function(e,n,s){s<i||(p(r.video.src,i,o.version,!1,t),i+=5)}),r.on("finish.drivetrack",function(){p(r.video.src,r.video.duration,o.version,!0,t),r.one("resume",function(){p(d.src,0,o.version,!1,t),i=5})}),r.on("seek",function(e,n,o){i=5*Math.ceil(o/5)})})})})};"object"==typeof module&&module.exports?module.exports=o:"function"==typeof flowplayer&&o(flowplayer)}();